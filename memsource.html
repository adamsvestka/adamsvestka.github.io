<html>
    <body>
        <script>
            window.onmessage = async event => {
                const result = {};
                try {
                    const { method, headers, body } = event.data.payload || {};
                    const response = await fetch(event.data.url, { method, headers, body, credentials: 'omit' });
                    for (const key of ['ok', 'status', 'statusText']) result[key] = response[key];
                    result.text = response.status != 204 ? await response.text() : null;
                } catch (error) {
                    result.ok = false;
                    result.error = error.message;
                }
                window.parent.postMessage(result, '*');
            }
        </script>
    </body>
</html>
